<!DOCTYPE html>
<html>
<head>
    <title>TrackNet Video Processing</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .video-container { display: flex; justify-content: center; gap: 20px; margin: 20px; }
        video { width: 400px; height: 300px; }
        .label { font-weight: bold; }
        .time-inputs { margin: 20px; }
        .time-inputs input { width: 100px; margin: 0 10px; }
    </style>
</head>
<body>
    <h1>TrackNet Video Processing</h1>
    <div>
        <input type="file" id="videoInput" accept="video/*">
    </div>
    <div class="time-inputs">
        <label>Start Time (seconds): <input type="number" id="startTime" min="0" step="0.1" value="0"></label>
        <label>End Time (seconds): <input type="number" id="endTime" min="0" step="0.1" value="0"></label>
    </div>
    <div class="video-container">
        <div>
            <div class="label">Input Video</div>
            <video id="inputVideo" controls></video>
        </div>
        <div>
            <div class="label">Output Video</div>
            <video id="outputVideo" controls></video>
        </div>
    </div>
    <button id="processButton" onclick="processVideo()">Processing</button>

    <script>
        document.getElementById('videoInput').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            const formData = new FormData();
            formData.append('video', file);
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            document.getElementById('inputVideo').src = 'data:video/mp4;base64,' + result.video;
            
            // Set default end time to video duration when video is loaded
            const video = document.getElementById('inputVideo');
            video.onloadedmetadata = function() {
                document.getElementById('endTime').value = video.duration.toFixed(1);
            };
        });

        async function processVideo() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            const response = await fetch('/process', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    startTime: parseFloat(startTime),
                    endTime: parseFloat(endTime)
                })
            });
            const result = await response.json();
            if (result.error) {
                alert(result.error);
                return;
            }
            document.getElementById('outputVideo').src = 'data:video/mp4;base64,' + result.video;
        }
    </script>
</body>
</html>